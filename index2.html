<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å•è¯æ‹¼å†™é—¯å…³æ¸¸æˆ</title>
  <style>
    /* æ ·å¼ä¿æŒä¸å˜ */
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      padding: 20px;
      text-align: center;
    }
    #game-container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
    }
    .letter-input, .fixed-letter {
      width: 30px;
      height: 36px;
      font-size: 20px;
      margin: 3px;
      text-align: center;
      border: none;
      border-bottom: 2px solid #000;
      background: transparent;
    }
    .letter-input.correct {
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .letter-box {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
    #result {
      margin-top: 15px;
      font-weight: bold;
    }
    .option-btn {
      display: block;
      margin: 6px auto;
      width: 80%;
    }
    #definition {
      margin: 10px;
      font-size: 16px;
      color: #4CAF50; 
    }
    #stats {
      margin-top: 15px;
      font-size: 14px;
      color: #666;
    }
    audio {
      display: none;
    }
    .streak-effect {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 32px;
      font-weight: bold;
      color: #ff9800;
      opacity: 0;
      animation: streak 1s forwards;
      pointer-events: none;
    }
    @keyframes streak {
      0% { opacity: 0; transform: translate(-50%, -20px); }
      50% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, 20px); }
    }
    .stars {
      color: #ffd700;
      font-size: 24px;
      margin: 10px 0;
    }
    .review-btn {
      background-color: #2196F3;
    }
    .review-btn:hover {
      background-color: #0b7dda;
    }
  </style>
</head>
<body>
<div id="game-container">
  <h1>å•è¯æ‹¼å†™é—¯å…³æ¸¸æˆ</h1>
  <audio id="bgm" autoplay loop>
    <source src="https://cdn.pixabay.com/audio/2022/10/30/audio_46fdd201cc.mp3" type="audio/mpeg">
  </audio>
  <audio id="correct-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_e0b6f67a53.mp3"></audio>
  <audio id="wrong-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_371f292d82.mp3"></audio>
  <div id="content">
    <div id="instruction"></div>
    <div id="definition"></div>
    <div id="question"></div>
    <div class="letter-box" id="letterBox"></div>
    <div>
      <button onclick="checkAnswer()">æ£€æŸ¥ç­”æ¡ˆ</button>
      <button onclick="submitAnswer()">ä¸‹ä¸€é¢˜</button>
      <button onclick="readWord()">ğŸ”Š å¬å•è¯</button>
      <button onclick="showMistakes()" class="review-btn">ğŸ“– æŸ¥çœ‹é”™é¢˜æœ¬</button>
      <button onclick="exitReview()" class="review-btn" style="display:none">è¿”å›é—¯å…³</button>
    </div>
    <div id="options"></div>
    <div id="result"></div>
    <div id="stats"></div>
  </div>
</div>
<script>
  const wordList = [
    {word:"morning", definition:"æ—©æ™¨ï¼›ä¸Šåˆ"},
    {word:"afternoon", definition:"åˆåï¼›ä¸‹åˆ"},
    {word:"evening", definition:"æ™šä¸Šï¼›å‚æ™š"},
    {word:"night", definition:"å¤œé—´ï¼›å¤œæ™š"},
    {word:"fine", definition:"å¥½çš„"},
    {word:"thank", definition:"æ„Ÿè°¢"},
    {word:"goodbye", definition:"å†è§"},
    {word:"woof", definition:"ç‹—å«å£°"},
    {word:"Mrs", definition:"å¤«äººï¼›å¤ªå¤ª"},
    {word:"day", definition:"ä¸€å¤©"},
    {word:"today", definition:"ä»Šå¤©"},
    {word:"very", definition:"å¾ˆï¼›éå¸¸"},
    {word:"well", definition:"å¥åº·çš„ï¼›èº«ä½“å¥½çš„"},
    {word:"hope", definition:"å¸Œæœ›"},
    {word:"too", definition:"å¤ªï¼›ä¹Ÿ"},
    {word:"apple", definition:"è‹¹æœ"},
    {word:"bag", definition:"åŒ…"},
    {word:"boy", definition:"ç”·å­©"},
    {word:"girl", definition:"å¥³å­©"},
    {word:"big", definition:"å¤§çš„"},
    {word:"small", definition:"å°çš„"},
    {word:"short", definition:"çŸ®çš„ï¼›çŸ­çš„"},
    {word:"thin", definition:"ç˜¦çš„ï¼›è–„çš„"},
    {word:"Miss", definition:"å¥³å£«ï¼›å°å§"},
    {word:"cat", definition:"çŒ«"},
    {word:"dog", definition:"ç‹—"},
    {word:"seven", definition:"ä¸ƒ"},
    {word:"eight", definition:"å…«"},
    {word:"nine", definition:"ä¹"},
    {word:"ten", definition:"å"},
    {word:"touch", definition:"è§¦æ‘¸"},
    {word:"knee", definition:"è†ç›–"},
    {word:"pick up", definition:"æ¡èµ·ï¼›æ‹¾èµ·"},
    {word:"stick", definition:"æ¯æï¼›æœ¨æ£"},
    {word:"draw", definition:"ç”»ï¼›ç»˜ç”»"},
    {word:"snake", definition:"è›‡"},
    {word:"again", definition:"å†ä¸€æ¬¡"},
    {word:"sorry", definition:"æŠ±æ­‰çš„ï¼›å¯¹ä¸èµ·"},
    {word:"elephant", definition:"å¤§è±¡"},
    {word:"five", definition:"äº”"},
    {word:"run", definition:"è·‘"},
    {word:"write", definition:"å†™"},
    {word:"swim", definition:"æ¸¸æ³³"},
    {word:"fly", definition:"é£"},
    {word:"sing", definition:"å”±ï¼ˆæ­Œï¼‰"},
    {word:"skip", definition:"è·³ç»³"},
    {word:"ride", definition:"éª‘ï¼ˆé©¬ï¼›è½¦ï¼‰"},
    {word:"bicycle", definition:"å•è½¦ï¼Œè‡ªè¡Œè½¦"},
    {word:"supergirl", definition:"è¶…çº§å¥³å­©"},
    {word:"but", definition:"ä½†æ˜¯"},
    {word:"hand", definition:"æ‰‹"},
    {word:"gate", definition:"å¤§é—¨"},
    {word:"plate", definition:"ç›˜å­"},
    {word:"young", definition:"å¹´è½»çš„"},
    {word:"old", definition:"è€çš„ï¼›æ—§çš„"},
    {word:"family", definition:"å®¶åº­"},
    {word:"friend", definition:"æœ‹å‹"},
    {word:"who", definition:"è°"},
    {word:"brother", definition:"å…„å¼Ÿ"},
    {word:"sister", definition:"å§å¦¹"},
    {word:"grandmother", definition:"ç¥–æ¯ï¼›å¥¶å¥¶ï¼›å¤–å©†"},
    {word:"mummy", definition:"ï¼ˆå£è¯­ï¼‰å¦ˆå¦ˆ"},
    {word:"daddy", definition:"ï¼ˆå£è¯­ï¼‰çˆ¸çˆ¸"},
    {word:"kind and dear", definition:"å’Œè”¼å¯äº²çš„"},
    {word:"nice", definition:"ç¾å¥½çš„"},
    {word:"sweet", definition:"ç”œçš„"},
    {word:"insect", definition:"æ˜†è™«"},
    {word:"jar", definition:"ç»ç’ƒç½"},
    {word:"hair", definition:"å¤´å‘"},
    {word:"head", definition:"å¤´"},
    {word:"face", definition:"è„¸"},
    {word:"mouth", definition:"å˜´"},
    {word:"eye", definition:"çœ¼ç›"},
    {word:"my", definition:"æˆ‘çš„"},
    {word:"your", definition:"ä½ çš„"},
    {word:"giant", definition:"å·¨äºº"},
    {word:"like", definition:"å–œæ¬¢"},
    {word:"long", definition:"é•¿çš„"},
    {word:"kite", definition:"é£ç­"},
    {word:"lion", definition:"ç‹®å­"},
    {word:"look", definition:"çœ‹ï¼›çœ‹èµ·æ¥"},
    {word:"slide", definition:"æ»‘æ¢¯"},
    {word:"swing", definition:"ç§‹åƒ"},
    {word:"seesaw", definition:"è··è··æ¿"},
    {word:"bee", definition:"èœœèœ‚"},
    {word:"yellow", definition:"é»„è‰²ï¼ˆçš„ï¼‰"},
    {word:"up", definition:"å‘ä¸Š"},
    {word:"down", definition:"å‘ä¸‹"},
    {word:"play", definition:"ï¼ˆå°¤æŒ‡å„¿ç«¥ï¼‰ç©ï¼›ç©è€"},
    {word:"see", definition:"çœ‹è§"},
    {word:"they", definition:"ä»–ï¼ˆå¥¹ï¼›å®ƒï¼‰ä»¬"},
    {word:"mouse", definition:"è€é¼ "},
    {word:"net", definition:"ç½‘"},
    {word:"man", definition:"ç”·äºº"},
    {word:"bag", definition:"åŒ…"},
    {word:"box", definition:"ç®±å­ï¼›ç›’å­"},
    {word:"desk", definition:"ä¹¦æ¡Œ"},
    {word:"chair", definition:"æ¤…å­"},
    {word:"book", definition:"ä¹¦"},
    {word:"pencil", definition:"é“…ç¬”"},
    {word:"pencil case", definition:"é“…ç¬”ç›’"},
    {word:"car", definition:"æ±½è½¦"},
    {word:"bear", definition:"ç†Š"},
    {word:"put", definition:"æ”¾"},
    {word:"in", definition:"åœ¨â€¦â€¦é‡Œé¢"},
    {word:"on", definition:"åœ¨â€¦â€¦ä¸Šé¢"},
    {word:"room", definition:"æˆ¿é—´"},
    {word:"love", definition:"å–œçˆ±"},
    {word:"like", definition:"åƒï¼›å¦‚åŒï¼›å–œæ¬¢"},
    {word:"use", definition:"ä½¿ç”¨"},
    {word:"every", definition:"æ¯ä¸ªï¼›æ¯ä¸€"},
    {word:"keep", definition:"ä¿æŒ"},
    {word:"clean", definition:"æ¸…æ´"},
    {word:"orange", definition:"æ©™è‰²ï¼›æ©™å­"},
    {word:"pig", definition:"çŒª"},
    {word:"has", definition:"æœ‰ï¼ˆhave ä¸‰å•å½¢å¼ï¼‰"},
    {word:"for", definition:"ç»™ï¼›ä¸ºäº†"},
    {word:"her", definition:"å¥¹çš„ï¼›å¥¹"},
    {word:"with", definition:"å’Œâ€¦â€¦ä¸€èµ·"},
    {word:"leg", definition:"è…¿"},
    {word:"come", definition:"æ¥ï¼›æ¥åˆ°"},
    {word:"eat", definition:"åƒ"},
    {word:"bowl", definition:"ç¢—"},
    {word:"plate", definition:"ç›˜å­"},
    {word:"spoon", definition:"å‹ºå­"},
    {word:"chopsticks", definition:"ç­·å­"},
    {word:"cook", definition:"åšé¥­"},
    {word:"dinner", definition:"æ™šé¤"},
    {word:"thanks", definition:"è°¢è°¢"},
    {word:"give", definition:"ç»™"},
    {word:"ready", definition:"å‡†å¤‡å¥½ï¼ˆåšæŸäº‹ï¼‰çš„"},
    {word:"here", definition:"åœ¨è¿™é‡Œï¼›æ­¤æ—¶"},
    {word:"How many", definition:"å¤šå°‘"},
    {word:"kitchen", definition:"å¨æˆ¿"},
    {word:"naughty", definition:"é¡½çš®çš„"},
    {word:"jump", definition:"è·³"},
    {word:"floor", definition:"åœ°æ¿"},
    {word:"under", definition:"åœ¨â€¦â€¦ä¸‹é¢"},
    {word:"queen", definition:"å¥³ç‹ï¼›ç‹å"},
    {word:"rabbit", definition:"å…”å­"},
    {word:"sit", definition:"å"},
    {word:"sun", definition:"å¤ªé˜³"},
    {word:"moon", definition:"æœˆäº®"},
    {word:"star", definition:"æ˜Ÿæ˜Ÿ"},
    {word:"sky", definition:"å¤©ç©º"},
    {word:"bright", definition:"æ˜äº®çš„"},
    {word:"twinkle", definition:"é—ªçƒï¼›é—ªè€€"},
    {word:"wonder", definition:"æƒ³çŸ¥é“"},
    {word:"above", definition:"åœ¨â€¦â€¦ä¸Šé¢"},
    {word:"world", definition:"ä¸–ç•Œ"},
    {word:"high", definition:"é«˜çš„"},
    {word:"diamond", definition:"é’»çŸ³"},
    {word:"soup", definition:"æ±¤"},
    {word:"soft", definition:"æŸ”è½¯çš„"},
    {word:"smooth", definition:"å…‰æ»‘çš„"},
    {word:"eat", definition:"åƒ"},
    {word:"fox", definition:"ç‹ç‹¸"},
    {word:"hippo", definition:"æ²³é©¬"},
    {word:"meat", definition:"è‚‰"},
    {word:"grass", definition:"è‰ï¼›è‰åœ°"},
    {word:"wild", definition:"é‡ç”Ÿçš„"},
    {word:"animal", definition:"åŠ¨ç‰©"},
    {word:"lion", definition:"ç‹®å­"},
    {word:"monkey", definition:"çŒ´å­"},
    {word:"banana", definition:"é¦™è•‰"},
    {word:"run", definition:"è·‘"},
    {word:"cute", definition:"å¯çˆ±çš„"},
    {word:"white", definition:"ç™½è‰²ï¼ˆçš„ï¼‰"},
    {word:"hop", definition:"å•è„šè·³"},
    {word:"naughty", definition:"é¡½çš®çš„"},
    {word:"brown", definition:"æ£•è‰²ï¼ˆçš„ï¼‰"},
    {word:"swing", definition:"ç§‹åƒ"},
    {word:"umbrella", definition:"é›¨ä¼"},
    {word:"van", definition:"ï¼ˆå¢å¼ï¼‰å°å‹è´§è½¦"},
    {word:"take", definition:"æ‹¿ï¼›å–èµ°"},
    {word:"raindrop", definition:"é›¨æ»´"},
    {word:"fall", definition:"æ‰è½"},
    {word:"close", definition:"å…³é—­"},
    {word:"window", definition:"çª—æˆ·"},
    {word:"flower", definition:"èŠ±"},
    {word:"tree", definition:"æ ‘"},
    {word:"pick", definition:"é‡‡ï¼›æ‘˜ï¼ˆèŠ±ã€æœï¼‰"},
    {word:"climb", definition:"æ”€çˆ¬"},
    {word:"colour", definition:"é¢œè‰²ï¼›æ¶‚é¢œè‰²"},
    {word:"cut", definition:"åˆ‡ï¼›å‰²ï¼›å‰ª"},
    {word:"beautiful", definition:"ç¾ä¸½çš„"},
    {word:"help", definition:"å¸®åŠ©"},
    {word:"cry", definition:"å“­ï¼›å“­æ³£"},
    {word:"zebra", definition:"æ–‘é©¬"},
    {word:"zoo", definition:"åŠ¨ç‰©å›­"},
    {word:"white", definition:"ç™½è‰²ï¼ˆçš„ï¼‰"},
    {word:"purple", definition:"ç´«è‰²ï¼ˆçš„ï¼‰"},
    {word:"pink", definition:"ç²‰çº¢è‰²ï¼ˆçš„ï¼‰"},
    {word:"orange", definition:"æ©™è‰²ï¼ˆçš„ï¼‰"},
    {word:"brown", definition:"æ£•è‰²ï¼ˆçš„ï¼‰"},
    {word:"black", definition:"é»‘è‰²ï¼ˆçš„ï¼‰"},
    {word:"green", definition:"ç»¿è‰²ï¼ˆçš„ï¼‰"},
    {word:"yellow", definition:"é»„è‰²ï¼ˆçš„ï¼‰"},
    {word:"blue", definition:"è“è‰²ï¼ˆçš„ï¼‰"},
    {word:"red", definition:"çº¢è‰²ï¼ˆçš„ï¼‰"},
    {word:"rainbow", definition:"å½©è™¹"},
    {word:"shine", definition:"å‘å…‰ï¼›ç…§è€€"},
    {word:"outside", definition:"åœ¨å¤–é¢"},
    {word:"window", definition:"çª—æˆ·"},
    {word:"pear", definition:"æ¢¨"},
    {word:"rabbit", definition:"å…”å­"},
    {word:"apple", definition:"è‹¹æœ"},
    {word:"bird", definition:"é¸Ÿ"},
    {word:"butterfly", definition:"è´è¶"},
    {word:"watch", definition:"è§‚çœ‹ï¼›æ³¨è§†"},
    {word:"go out", definition:"å‡ºå»"},
    {word:"house", definition:"æˆ¿å±‹"},
    {word:"want", definition:"æƒ³è¦"},
    {word:"some", definition:"æœ‰äº›ï¼›ä¸€äº›"},
    {word:"sleep", definition:"ç¡è§‰"},
    {word:"little", definition:"ä¸€ç‚¹å„¿ï¼›å°‘é‡çš„"}
  ];

  const puzzleQuestions = [
    { question: "â€œæ—¥å‡ºå¤§ç±³â€çŒœä¸€ä¸ªå­—ï¼Ÿ", options: ["æ˜", "æ˜Œ", "æ—©", "äº®"], answer: "æ˜Œ" },
    { question: "2ï¼Œ4ï¼Œ8ï¼Œ16ï¼Œ__ï¼Ÿ", options: ["24", "32", "48", "64"], answer: "32" },
    { question: "å°æ˜ä»æ¥¼ä¸Šæ‰ä¸‹æ¥å´æ²¡å—ä¼¤ï¼Œä¸ºä»€ä¹ˆï¼Ÿ", options: ["åœ°ä¸Šæœ‰å«å­", "ä»–æ˜¯è¶…äºº", "ä»–åœ¨åšæ¢¦", "æ¥¼å±‚ä½"], answer: "ä»–åœ¨åšæ¢¦" },
    { question: "ä»€ä¹ˆä¸œè¥¿è¶Šæ´—è¶Šè„ï¼Ÿ", options: ["è¡£æœ", "æ°´", "æ‰‹", "æµ·ç»µ"], answer: "æ°´" },
    { question: "å“ªç§é’¥åŒ™æ‰“ä¸å¼€é—¨ï¼Ÿ", options: ["æ±½è½¦é’¥åŒ™", "æˆ¿é—¨é’¥åŒ™", "ç¬‘è¯", "ä¿é™©ç®±é’¥åŒ™"], answer: "ç¬‘è¯" },
    { question: "ä¸€åªæ‰‹èƒ½æ‹å¤šå°‘ä¸ªå“ï¼Ÿ", options: ["ä¸€ä¸ª", "ä¸¤ä¸ª", "ä¸‰ä¸ª", "å››ä¸ª"], answer: "ä¸€ä¸ª" },
    { question: "ä»€ä¹ˆä¸œè¥¿æœ‰äº”ä¸ªå¤´ï¼Œä½†äººä¸è§‰å¾—å®ƒæ€ªï¼Ÿ", options: ["æ€ªç‰©", "æ‰‹", "è„š", "è›‡"], answer: "æ‰‹" },
    { question: "1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ__ï¼Ÿ", options: ["10", "11", "12", "13"], answer: "11" },
    { question: "ä»€ä¹ˆä¸œè¥¿æ™šä¸Šæ‰ä¼šé•¿å‡ºå°¾å·´ï¼Ÿ", options: ["æµæ˜Ÿ", "æœˆäº®", "å½±å­", "çŒ«"], answer: "æµæ˜Ÿ" },
    { question: "ä»€ä¹ˆä¸œè¥¿è§è€…æœ‰ä»½ï¼Ÿ", options: ["ç¤¼ç‰©", "é˜³å…‰", "ç©ºæ°”", "é£æ™¯"], answer: "é˜³å…‰" },
    { question: "ä»€ä¹ˆä¸œè¥¿è¶Šç”Ÿæ°”ï¼Œå®ƒå°±è¶Šå¤§ï¼Ÿ", options: ["æ°”çƒ", "è„¾æ°”", "ä¼¤å£", "ç«ç„°"], answer: "è„¾æ°”" },
    { question: "â€œä¸€åŠ ä¸€ä¸æ˜¯äºŒâ€çŒœä¸€ä¸ªå­—ï¼Ÿ", options: ["ç‹", "ä¸°", "ç”°", "ç”±"], answer: "ç‹" },
    { question: "3ï¼Œ6ï¼Œ9ï¼Œ12ï¼Œ__ï¼Ÿ", options: ["13", "14", "15", "16"], answer: "15" },
    { question: "ä»€ä¹ˆä¸œè¥¿äººä»¬åœ¨ä¸åœåœ°åƒå®ƒï¼Œå´æ°¸è¿œåƒä¸é¥±ï¼Ÿ", options: ["ç©ºæ°”", "é›¶é£Ÿ", "çŸ¥è¯†", "ç±³é¥­"], answer: "ç©ºæ°”" },
    { question: "ä»€ä¹ˆä¸œè¥¿èƒ½è½½åŠ¨ä¸€ç™¾æ†å¹²è‰ï¼Œå´æ‰˜ä¸èµ·ä¸€ç²’æ²™å­ï¼Ÿ", options: ["èˆ¹", "è½¦", "æ°´", "é£"], answer: "æ°´" },
    { question: "ä»€ä¹ˆä¸œè¥¿æœ‰è…¿å´ä¸èƒ½èµ°è·¯ï¼Ÿ", options: ["æ¡Œå­", "ç‹—", "è›‡", "äºº"], answer: "æ¡Œå­" },
    { question: "â€œåå­—å¯¹åå­—ï¼Œå¤ªé˜³å¯¹æœˆäº®â€çŒœä¸€ä¸ªå­—ï¼Ÿ", options: ["æœ", "èŒ", "æ˜", "å†’"], answer: "æœ" },
    { question: "5ï¼Œ10ï¼Œ15ï¼Œ20ï¼Œ__ï¼Ÿ", options: ["22", "25", "30", "35"], answer: "25" },
    { question: "ä»€ä¹ˆä¸œè¥¿å¤©æ°”è¶Šçƒ­ï¼Œå®ƒçˆ¬å¾—è¶Šé«˜ï¼Ÿ", options: ["æ¸©åº¦è®¡", "å¤ªé˜³", "æ±—æ°´", "å½±å­"], answer: "æ¸©åº¦è®¡" },
    { question: "ä»€ä¹ˆä¸œè¥¿æ‰“ç ´äº†æ‰èƒ½åƒï¼Ÿ", options: ["é¸¡è›‹", "ç»ç’ƒ", "çŸ³å¤´", "è¥¿ç“œ"], answer: "é¸¡è›‹" },
    { question: "ä»€ä¹ˆä¸œè¥¿æ´—å¥½äº†å´ä¸èƒ½åƒï¼Ÿ", options: ["è¡£æœ", "æ°´æœ", "è”¬èœ", "ç±³é¥­"], answer: "è¡£æœ" },
    { question: "â€œä¸€è¾¹çº¢ï¼Œä¸€è¾¹ç»¿ï¼Œä¸€è¾¹å–œé›¨ï¼Œä¸€è¾¹å–œé£â€çŒœä¸€ä¸ªå­—ï¼Ÿ", options: ["ç§‹", "æ˜", "æ™´", "é˜³"], answer: "ç§‹" },
    { question: "1ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ__ï¼Ÿ", options: ["7", "8", "9", "10"], answer: "8" },
    { question: "ä»€ä¹ˆä¸œè¥¿æ²¡è„šèµ°å¤©ä¸‹ï¼Ÿ", options: ["èˆ¹", "è½¦", "é£", "è·¯"], answer: "èˆ¹" },
    { question: "ä»€ä¹ˆä¸œè¥¿æœ‰å˜´ä¸è¯´è¯ï¼Œæœ‰è„šä¸èµ°è·¯ï¼Ÿ", options: ["æ¡Œå­", "èŒ¶å£¶", "ç”µè„‘", "æ‰‹æœº"], answer: "èŒ¶å£¶" },
    { question: "ä»€ä¹ˆä¸œè¥¿è¶Šå‰ªè¶Šå¤§ï¼Ÿ", options: ["æ´", "çº¸", "å¸ƒ", "å¤´å‘"], answer: "æ´" },
    { question: "â€œæœ‰å¤´æ— é¢ˆï¼Œæœ‰çœ¼æ— çœ‰ï¼Œæ— è„šèƒ½èµ°ï¼Œæœ‰ç¿…éš¾é£â€çŒœä¸€åŠ¨ç‰©ï¼Ÿ", options: ["é±¼", "è›‡", "è›™", "é¸Ÿ"], answer: "é±¼" },
    { question: "2ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ11ï¼Œ__ï¼Ÿ", options: ["12", "13", "14", "15"], answer: "13" }
  ];

  // æ¸¸æˆå˜é‡
  let currentIndex = 0;
  let level = 0;
  let inPuzzle = false;
  let correctCount = 0;
  let wrongList = [];
  let isReviewMode = false;
  let currentStreak = 0;
  let levelStars = [];
  let currentReviewIndex = 0;
  let levelCorrect = 0;

  const instructionEl = document.getElementById("instruction");
  const questionEl = document.getElementById("question");
  const resultEl = document.getElementById("result");
  const optionsEl = document.getElementById("options");
  const definitionEl = document.getElementById("definition");
  const letterBox = document.getElementById("letterBox");
  const statsEl = document.getElementById("stats");

  const correctSound = document.getElementById("correct-sound");
  const wrongSound = document.getElementById("wrong-sound");

  function updateStats() {
    statsEl.textContent = `æ­£ç¡®ï¼š${correctCount}  é”™è¯¯ï¼š${wrongList.length}  è¿›åº¦ï¼š${currentIndex} / ${wordList.length}`;
  }

  function loadNext() {
    resultEl.textContent = "";
    optionsEl.innerHTML = "";
    letterBox.innerHTML = "";
    updateStats();

    // é”™é¢˜å›é¡¾æ¨¡å¼
    if (isReviewMode) {
      document.querySelector('button[onclick="exitReview()"]').style.display = "inline-block";
      if (currentReviewIndex >= wrongList.length) {
        instructionEl.textContent = "ğŸ“š å·²å®Œæˆæ‰€æœ‰é”™é¢˜å›é¡¾ï¼";
        definitionEl.textContent = "";
        questionEl.textContent = "";
        return;
      }
      const wordObj = wrongList[currentReviewIndex];
      instructionEl.textContent = `é”™é¢˜å›é¡¾ ç¬¬ ${currentReviewIndex + 1}/${wrongList.length} é¢˜`;
      definitionEl.textContent = `ä¸­æ–‡æç¤ºï¼š${wordObj.definition}`;
      questionEl.textContent = "è¯·è¡¥å…¨å•è¯ï¼š";
	  
      // ç”Ÿæˆè¾“å…¥æ¡†ï¼ˆé¦–å­—æ¯å›ºå®šï¼‰
      const first = document.createElement("input");
      first.type = "text";
      first.maxLength = 1;
      first.className = "fixed-letter";
      first.value = wordObj.word[0];
      first.readOnly = true;
      letterBox.appendChild(first);

      for (let i = 1; i < wordObj.word.length; i++) {
        const input = document.createElement("input");
        input.type = "text";
        input.maxLength = 1;
        input.className = "letter-input";
        input.dataset.index = i;
        input.setAttribute("autocapitalize", "off");
        addInputListeners(input);
        letterBox.appendChild(input);
      }
      letterBox.querySelector("input.letter-input")?.focus();
      return;
    }

    // æ­£å¸¸é—¯å…³æ¨¡å¼
    document.querySelector('button[onclick="exitReview()"]').style.display = "none";
    const start = level * 8;
    if (currentIndex - start >= 8) {
      showPuzzle();
      return;
    }
    if (currentIndex >= wordList.length) {
      instructionEl.textContent = "ğŸ‰ æ­å–œä½ å®Œæˆæ‰€æœ‰å•è¯ï¼";
      definitionEl.innerHTML = `æ€»æ˜Ÿçº§ï¼š${levelStars.reduce((a, b) => a + b, 0)}/${levelStars.length * 3} â­`;
      questionEl.textContent = "";
      return;
    }

    const wordObj = wordList[currentIndex];
    instructionEl.textContent = `ç¬¬ ${level + 1} å…³ ç¬¬ ${currentIndex - start + 1} ä¸ªè¯`;
    definitionEl.textContent = `ä¸­æ–‡æç¤ºï¼š${wordObj.definition}`;
    questionEl.textContent = "è¯·åœ¨ä¸‹æ–¹å¡«å†™å®Œæ•´å•è¯ï¼š";

    // ç”Ÿæˆè¾“å…¥æ¡†ï¼ˆé¦–å­—æ¯å›ºå®šï¼‰
    const first = document.createElement("input");
    first.type = "text";
    first.maxLength = 1;
    first.className = "fixed-letter";
    first.value = wordObj.word[0];
    first.readOnly = true;
    letterBox.appendChild(first);

    for (let i = 1; i < wordObj.word.length; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.maxLength = 1;
      input.className = "letter-input";
      input.dataset.index = i;
      addInputListeners(input);
      letterBox.appendChild(input);
    }
    letterBox.querySelector("input.letter-input")?.focus();
  }

  let isComposing = false;  // å¤„ç†ä¸­æ–‡è¾“å…¥
  function handleInput(e) {
    if (isComposing) return;
    const input = e.target;
    input.value = input.value.slice(0, 1).toLowerCase(); // é™åˆ¶ä¸ºå°å†™å­—æ¯
    input.classList.add("correct");
    const next = input.nextElementSibling;
    if (next && next.tagName === 'INPUT') next.focus();
  }

  function handleBackspace(e) {
    if (e.key === "Backspace") {
      if (e.target.value) {
        e.target.value = "";
        e.preventDefault();
      } else {
        const prev = e.target.previousElementSibling;
        if (prev && prev.tagName === 'INPUT') {
          prev.focus();
          e.preventDefault();
        }
      }
    }
  }

  function addInputListeners(input) {
    input.addEventListener("input", handleInput);
    input.addEventListener("keydown", handleBackspace);
    input.addEventListener("compositionstart", () => isComposing = true);
    input.addEventListener("compositionend", (e) => {
      isComposing = false;
      handleInput(e);
    });
  }

  // æ–°å¢ï¼šæ£€æŸ¥ç­”æ¡ˆåŠŸèƒ½ï¼ˆä¸è·³è½¬ä¸‹ä¸€é¢˜ï¼‰
  function checkAnswer() {
    if (inPuzzle || isReviewMode) return;

    const wordObj = wordList[currentIndex];
    const inputs = letterBox.querySelectorAll("input.letter-input");
    let filled = "";
    inputs.forEach(input => filled += input.value || "");
    const userAns = (wordObj.word[0] + filled).toLowerCase();

    if (userAns === wordObj.word.toLowerCase()) {
      resultEl.textContent = "âœ… æ­£ç¡®ï¼å¯ä»¥è¿›å…¥ä¸‹ä¸€é¢˜äº†";
      correctSound.play();
    } else {
      resultEl.textContent = "âŒ é”™è¯¯ï¼Œå†è¯•ä¸€æ¬¡å§";
      wrongSound.play();
    }
  }

  // ä¸‹ä¸€é¢˜åŠŸèƒ½ï¼šåˆ¤æ–­å¯¹é”™å¹¶è®°å½•
  function submitAnswer() {
    if (inPuzzle) return;
    
    // é”™é¢˜å›é¡¾æ¨¡å¼æäº¤
    if (isReviewMode) {
      const wordObj = wrongList[currentReviewIndex];
      const inputs = letterBox.querySelectorAll("input.letter-input");
      let filled = "";
      inputs.forEach(input => filled += input.value || "");
      const userAns = filled.toLowerCase();

      if (userAns === wordObj.word.toLowerCase()) {
        resultEl.textContent = "âœ… æ­£ç¡®ï¼";
        correctSound.play();
        currentReviewIndex++;
        setTimeout(loadNext, 800);
      } else {
        resultEl.textContent = "âŒ é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚";
        wrongSound.play();
      }
      return;
    }

    // æ­£å¸¸æ¨¡å¼æäº¤ï¼šç‚¹å‡»ä¸‹ä¸€é¢˜æ—¶åˆ¤æ–­å¯¹é”™
    const wordObj = wordList[currentIndex];
    const inputs = letterBox.querySelectorAll("input.letter-input");
    let filled = "";
    inputs.forEach(input => filled += input.value || "");
    const userAns = (wordObj.word[0] + filled).toLowerCase();

    if (userAns === wordObj.word.toLowerCase()) {
      resultEl.textContent = "âœ… æ­£ç¡®ï¼";
      correctSound.play();
      correctCount++;
      currentStreak++;
      levelCorrect++;

      // è¿å‡»ç‰¹æ•ˆ
      if (currentStreak >= 3) {
        const streakEl = document.createElement("div");
        streakEl.className = "streak-effect";
        streakEl.textContent = `è¿å‡» x${currentStreak}!`;
        document.body.appendChild(streakEl);
        setTimeout(() => streakEl.remove(), 1000);
      }
    } else {
      resultEl.textContent = "âŒ é”™è¯¯ï¼Œå·²è®°å½•åˆ°é”™é¢˜æœ¬";
      wrongSound.play();
      currentStreak = 0;
      if (!wrongList.includes(wordObj)) wrongList.push(wordObj);
    }
    
    // è¿›å…¥ä¸‹ä¸€é¢˜
    currentIndex++;
    setTimeout(loadNext, 800);
    updateStats();
  }

  function showPuzzle() {
    inPuzzle = true;
    letterBox.innerHTML = "";
    optionsEl.innerHTML = "";
    definitionEl.textContent = "";
    resultEl.textContent = "";

    // è®¡ç®—å½“å‰å…³å¡æ˜Ÿçº§
    const rate = levelCorrect / 8;
    let stars = 1;
    if (rate === 1) stars = 3;
    else if (rate >= 0.75) stars = 2;
    levelStars.push(stars);

    const unused = puzzleQuestions.filter(q => !q.used);
    if (unused.length === 0) {
      levelCorrect = 0;
      loadNext();
      return;
    }
    const puzzle = unused[Math.floor(Math.random() * unused.length)];
    puzzle.used = true;
    questionEl.textContent = `ğŸ¯ å…³å¡æŒ‘æˆ˜ï¼š${puzzle.question}`;
    definitionEl.innerHTML = `æœ¬å…³è¯„åˆ†ï¼š${"â­".repeat(stars)}`;

    puzzle.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.className = "option-btn";
      btn.onclick = () => {
        if (opt === puzzle.answer) {
          resultEl.textContent = "ğŸ‰ ç­”å¯¹äº†ï¼Œè¿›å…¥ä¸‹ä¸€å…³ï¼";
          correctSound.play();
          level++;
          levelCorrect = 0;
          currentIndex = level * 8;
          setTimeout(() => {
            inPuzzle = false;
            loadNext();
          }, 1000);
        } else {
          resultEl.textContent = "ğŸ˜¥ å†è¯•è¯•ï¼";
          wrongSound.play();
        }
      };
      optionsEl.appendChild(btn);
    });
  }

  function readWord() {
    const word = isReviewMode 
      ? wrongList[currentReviewIndex]?.word 
      : wordList[currentIndex]?.word;
    if (!word) return;
    const utter = new SpeechSynthesisUtterance(word);
    utter.lang = "en-US";
    speechSynthesis.speak(utter);
  }

  function showMistakes() {
    if (wrongList.length === 0) {
      alert("ç›®å‰æ²¡æœ‰é”™é¢˜ï¼");
      return;
    }
    isReviewMode = true;
    currentReviewIndex = 0;
    loadNext();
  }

  function exitReview() {
    isReviewMode = false;
    loadNext();
  }

  loadNext();
</script>
</body>
</html>